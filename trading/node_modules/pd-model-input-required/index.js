'use strict';
var _ = require('underscore');
var extCreate = require('./lib/extends-create');
var extModify = require('./lib/extends-modify');

module.exports = function (Record) {
    var nonEmpties = [];
    var criteria = {};
    Record.allNonEmpties = function () {
        return nonEmpties.slice();
    };

    Record.inputCriteriaOf = function (field) {
        return criteria[field];
    };

    Record.fieldsInCriteria = function () {
        return Object.keys(criteria);
    };

    Record.needInputOf = function (fields) {
        var fds = !_.isArray(fields) ? [fields] : fields;
        (fds || []).forEach(function (field) {
            if (nonEmpties.indexOf(field) < 0) {
                nonEmpties.push(field);
            }
        });
        return Record;
    };

    Record.eachInputOf = function (field) {
        return {
            mustMatch: function (pattern) {
                if (_.isRegExp(pattern) || _.isFunction(pattern)) {
                    if (!criteria[field]) {
                        criteria[field] = [];
                    }
                    var store = criteria[field];
                    if (store.indexOf(pattern) < 0) {
                        store.push(pattern);
                    }
                }
                return Record;
            }
        };
    };
    extCreate(Record);
    extModify(Record);
};
