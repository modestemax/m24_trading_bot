'use strict';
var _ = require('underscore');
var announcer = require('pd-api-announcer');
var q = require('q');

module.exports = function (Record, profile, onlyInputFields) {
    return q.Promise(function (resolve) {
        var prof = profile || {};
        var allNonEmpties = Record.allNonEmpties();
        var allFields = (onlyInputFields ?
            _.intersection(Object.keys(prof), allNonEmpties) : Record.allNonEmpties() || []);
        var emptyField = _.find(allFields, function (field) {
            var fieldValue = prof[field] || '';
            return !_.isBoolean(field) && !_.isNumber(fieldValue) && (!fieldValue || _.isEmpty(fieldValue));
        });
        if (emptyField) {
            throw announcer.error.req(emptyField, 'empty');
        }
        resolve();
    });

};