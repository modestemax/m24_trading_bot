'use strict';
var lock = require('pd-redis-lock');
var _ = require('underscore');

var utility = {
    sidSetOf: function (Record, onLocked, expiresInMs) {
        var nomen = Record.nm;
        var redis = Record.redis;
        return lock(nomen.sidSet(), onLocked, expiresInMs, redis);
    },
    dataForSid: function (Record, sid, onLocked, expiresInMs) {
        var nomen = Record.nm;
        var redis = Record.redis;
        return lock(nomen.dataForSid(sid), onLocked, expiresInMs, redis);
    }
};
module.exports = _.extend(utility, {
    specFor: function (Record) {
        return {
            sidSet: function (onLocked, expiresInMs) {
                return utility.sidSetOf(Record, onLocked, expiresInMs);
            },
            dataForSid: function (sid, onLocked, expiresInMs) {
                return utility.dataForSid(Record, sid, onLocked, expiresInMs);
            }
        };
    }
});
