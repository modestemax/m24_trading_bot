'use strict';
var announcer = require('pd-api-announcer');

var checkExistence = function (Record, sid, forPresence) {
    var nomen = Record.nm;
    var redis = Record.redis;
    var flag = forPresence ? 1 : 0;
    var symptom = forPresence ? 'gone' : 'taken';
    var queryKey = nomen.dataForSid(sid);
    return redis.exec('exists', queryKey).then(function (reply) {
        if (parseInt(reply) !== flag) {
            throw announcer.error.sys(nomen.modelName(), symptom, sid);
        }
        return reply;
    });
};

module.exports = {
    checkAbsence: function (Record, sid) {
        return checkExistence(Record, sid, false);
    },
    checkPresence: function (Record, sid) {
        return checkExistence(Record, sid, true);
    }
};
