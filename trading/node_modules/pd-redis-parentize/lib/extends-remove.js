'use strict';
var pluralize = require('pluralize');
var announcer = require('pd-api-announcer');
var methodNomen = require('./nomenclt');

module.exports = function (Parent, Child) {
    var oldRemove = Parent.remove;
    Parent.remove = function (parentSid, multiGen) {
        var childAmountName = methodNomen.counterFor(Child);
        return Parent[childAmountName].call(Parent, parentSid).then(function (amount) {
            if (amount > 0) {
                throw announcer.error.sys(pluralize(Child.modelName()), 'non-empty');
            }
        }).then(function () {
            return oldRemove.call(Parent, parentSid, multiGen);
        });
    };
};

