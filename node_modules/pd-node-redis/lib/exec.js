'use strict';
var q = require('q');
var announcer = require('pd-api-announcer');
var _ = require('underscore');
var defaultCli = require('./default-cli');

module.exports = function (command, argsOfCmd, cli) {
    return q.Promise(function (resolve, reject) {
        var client = cli || defaultCli;
        var cmd = command || '';
        var args = _.isString(argsOfCmd) ? [argsOfCmd] : argsOfCmd;
        announcer.assertNonEmptyString(cmd, 'redis:exec:command');
        announcer.assertArray(args, 'redis:exec:args');
        args.push(function (err, reply) {
            if (err) {
                return reject(err);
            }
            resolve(reply);
        });
        var exec = client[cmd];
        if (!(exec instanceof Function)) {
            throw announcer.error.sys('redis-cmd', 'unsupported:' + cmd);
        }
        exec.apply(client, args);
    });
};