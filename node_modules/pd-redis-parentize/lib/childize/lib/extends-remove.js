'use strict';
var q = require('q');
var nomen = require('./nomenclt');

module.exports = function (Child, Parent) {
    var oldRemove = Child.remove;
    Child.remove = function (sid, multiGen) {
        var oldMultis = multiGen || function (multis) {
                return multis;
            };
        var sidStr = sid + '';
        var multiG;
        return q.Promise(function (resolve) {
            resolve(
                Child.findBySid(sid, {
                    fields: [nomen.parentSid(Parent)]
                })
            );
        }).then(function (fields) {
            multiG = fields[0] ? function (multis) {
                var mGenArgs = arguments;
                var relationshipName = nomen.childOf(Child, Parent, fields[0]);
                multis.push(['zrem', relationshipName, sidStr]);
                return q.Promise(function (resolve) {
                    resolve(multis);
                }).then(function () {
                    return oldMultis.apply(Child, mGenArgs);
                });
            } : oldMultis;
        }).then(function () {
            return oldRemove.call(Child, sid, multiG);
        });
    };

};
